# Redis 7 Development Configuration
# This file contains development-specific overrides

################################# GENERAL #####################################

# More verbose logging for development
loglevel verbose

# Enable debug logging
# loglevel debug

################################ SNAPSHOTTING  ################################

# More frequent saves for development (to prevent data loss)
save 300 1     # Save if at least 1 key changed in 300 seconds
save 60 10     # Save if at least 10 keys changed in 60 seconds
save 10 1000   # Save if at least 1000 keys changed in 10 seconds

# Allow writes even if RDB snapshots fail (for development)
stop-writes-on-bgsave-error no

################################## SECURITY ###################################

# Disable some security restrictions for development
# (WARNING: Only use in development environments)

# Allow dangerous commands in development
rename-command FLUSHDB "FLUSHDB"
rename-command FLUSHALL "FLUSHALL"
rename-command DEBUG "DEBUG"
rename-command CONFIG "CONFIG"
rename-command EVAL "EVAL"

# Allow configuration changes via CONFIG SET
# protected-mode no

############################## MEMORY MANAGEMENT #############################

# Smaller memory limit for development
maxmemory 128mb

# Use volatile-lru policy for development (preserve important keys)
maxmemory-policy volatile-lru

# More samples for better LRU approximation in development
maxmemory-samples 10

############################# LAZY FREEING ####################################

# Enable lazy freeing for better performance in development
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
replica-lazy-flush yes
lazyfree-lazy-user-del yes
lazyfree-lazy-user-flush yes

############################## APPEND ONLY FILE ###############################

# Disable AOF for development (faster, but less durable)
# appendonly no

# If AOF is enabled, use faster sync policy
# appendfsync no

# Allow fsync during rewrites in development
no-appendfsync-on-rewrite yes

# More aggressive AOF rewrite for development
auto-aof-rewrite-percentage 50
auto-aof-rewrite-min-size 32mb

################################## SLOW LOG ###################################

# Lower threshold for slow log in development
slowlog-log-slower-than 1000

# Keep more slow log entries for debugging
slowlog-max-len 256

################################ LATENCY MONITOR ##############################

# Lower latency monitoring threshold for development
latency-monitor-threshold 10

############################# EVENT NOTIFICATION ##############################

# Enable keyspace notifications for development/debugging
notify-keyspace-events "Ex"

############################### ADVANCED CONFIG ###############################

# Smaller limits for development
hash-max-ziplist-entries 256
hash-max-ziplist-value 32

list-max-ziplist-size -1
list-compress-depth 1

set-max-intset-entries 256

zset-max-ziplist-entries 64
zset-max-ziplist-value 32

# Smaller stream node for development
stream-node-max-bytes 2kb
stream-node-max-entries 50

# More frequent rehashing for development
hz 50

# Enable dynamic hz for better responsiveness
dynamic-hz yes

# Smaller client buffers for development
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit replica 64mb 16mb 60
client-output-buffer-limit pubsub 8mb 2mb 60

# Smaller query buffer limit
client-query-buffer-limit 256mb

# Smaller protocol buffer
proto-max-bulk-len 128mb

# Faster incremental fsync for development
aof-rewrite-incremental-fsync yes
rdb-save-incremental-fsync yes

# Development-friendly LFU settings
lfu-log-factor 5
lfu-decay-time 1

################################# DEVELOPMENT #################################

# Development-specific settings

# Enable all keyspace notifications for debugging
# notify-keyspace-events "AKE"

# Disable protected mode for easier local development
# protected-mode no

# Allow local connections without authentication
# bind 127.0.0.1

# Enable Redis modules loading (for development/testing)
# enable-module-command yes

# Increase timeout for development debugging
timeout 0

# Enable TCP keepalive for development connections
tcp-keepalive 60