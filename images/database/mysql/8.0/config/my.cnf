[mysqld]
# Basic settings
user = mysql
pid-file = /var/run/mysqld/mysqld.pid
socket = /var/run/mysqld/mysqld.sock
datadir = /var/lib/mysql
tmpdir = /tmp
lc-messages-dir = /usr/share/mysql

# Skip external locking and DNS resolution
skip-external-locking
skip-name-resolve
skip-host-cache

# Character set and collation (MySQL 8.4 defaults)
character-set-server = utf8mb4
collation-server = utf8mb4_0900_ai_ci
init-connect = 'SET NAMES utf8mb4'

# Connection settings
max_connections = 200
max_user_connections = 190
max_connect_errors = 1000000
connect_timeout = 10
wait_timeout = 28800
interactive_timeout = 28800

# Buffer settings (optimized for production)
key_buffer_size = 32M
table_open_cache = 4000
table_definition_cache = 1000
sort_buffer_size = 2M
read_buffer_size = 2M
read_rnd_buffer_size = 4M
join_buffer_size = 2M

# MyISAM settings (legacy support)
myisam_sort_buffer_size = 64M
myisam_max_sort_file_size = 10G
# Note: myisam_repair_threads was removed in MySQL 8.0

# InnoDB settings (production optimized for MySQL 8.4)
innodb_buffer_pool_size = 1G
innodb_buffer_pool_instances = 4
innodb_redo_log_capacity = 512M
innodb_log_buffer_size = 16M
innodb_flush_log_at_trx_commit = 1
innodb_lock_wait_timeout = 50
innodb_file_per_table = 1
innodb_open_files = 400
innodb_io_capacity = 400
innodb_io_capacity_max = 2000
innodb_flush_method = O_DIRECT
innodb_thread_concurrency = 0
innodb_read_io_threads = 4
innodb_write_io_threads = 4
innodb_doublewrite = 1
innodb_checksum_algorithm = crc32
innodb_undo_log_truncate = 1
innodb_max_undo_log_size = 1G
innodb_purge_rseg_truncate_frequency = 128
innodb_dedicated_server = 0

# MySQL 8.4 specific InnoDB settings
innodb_parallel_read_threads = 4
innodb_ddl_threads = 4
innodb_extend_and_initialize = 1

# Thread settings
thread_cache_size = 50
thread_stack = 256K

# Logging
log-error = /var/log/mysql/error.log
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 0
log_slow_admin_statements = 1
log_slow_replica_statements = 1

# Binary logging
server-id = 1
log-bin = /var/log/mysql/mysql-bin
binlog_format = ROW
binlog_expire_logs_seconds = 604800  # 7 days
max_binlog_size = 100M
sync_binlog = 1

# GTID settings (MySQL 8.4 enhanced)
gtid_mode = ON
enforce_gtid_consistency = ON

# Performance Schema
performance_schema = ON
performance_schema_max_table_instances = 400
performance_schema_max_table_handles = 4000

# Information Schema optimizations
information_schema_stats_expiry = 86400

# Security settings
local_infile = 0
secure_file_priv = /var/lib/mysql-files/

# SSL settings
ssl_ca = /var/lib/mysql/ca.pem
ssl_cert = /var/lib/mysql/server-cert.pem
ssl_key = /var/lib/mysql/server-key.pem

# Time zone
default_time_zone = '+00:00'

# SQL mode (MySQL 8.4 recommended)
sql_mode = STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO

# MySQL 8.4 specific settings
caching_sha2_password_auto_generate_rsa_keys = ON
default_authentication_plugin = caching_sha2_password

# Regular expression engine
regexp_time_limit = 32
regexp_stack_limit = 8000000

# JSON and document store optimizations
innodb_default_row_format = dynamic

# Optimizer settings
optimizer_switch = 'index_merge=on,index_merge_union=on,index_merge_sort_union=on,index_merge_intersection=on,engine_condition_pushdown=on,index_condition_pushdown=on,mrr=on,mrr_cost_based=on,block_nested_loop=on,batched_key_access=off,materialization=on,semijoin=on,loosescan=on,firstmatch=on,duplicateweedout=on,subquery_materialization_cost_based=on,use_index_extensions=on,condition_fanout_filter=on,derived_merge=on,use_invisible_indexes=off,skip_scan=on,hash_join=on,subquery_to_derived=off,prefer_ordering_index=on,hypergraph_optimizer=off,derived_condition_pushdown=on'

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
port = 3306
socket = /var/run/mysqld/mysqld.sock