; Testing PHP configuration - extends development settings
[PHP]

; Override settings for testing environment
max_execution_time = 0
memory_limit = 2G
post_max_size = 2G
upload_max_filesize = 2G

; Error reporting for testing
error_reporting = E_ALL
display_errors = On
display_startup_errors = On
log_errors = On
log_errors_max_len = 0

; Testing-specific settings
assert.active = On
assert.exception = On
assert.warning = On
assert.bail = Off

; Disable OPcache for testing to ensure fresh code execution
opcache.enable = 0
opcache.enable_cli = 0

; Session settings for testing
session.use_cookies = Off
session.use_only_cookies = Off
session.use_trans_sid = Off
session.cache_limiter =
session.save_handler = files
session.save_path = "/tmp/test-sessions"

; Increase limits for testing
max_input_vars = 50000
max_input_nesting_level = 256
pcre.backtrack_limit = 10000000
pcre.recursion_limit = 1000000

; File upload settings for testing
file_uploads = On
upload_tmp_dir = "/tmp/test-uploads"
max_file_uploads = 100

; Mail settings for testing (prevent actual sending)
sendmail_from = test@zairakai.local
sendmail_path = "/usr/bin/true"

; Timezone for consistent testing
date.timezone = "UTC"

; Testing error log
error_log = /var/log/testing/php_errors.log

; Disable functions that might interfere with testing
; Remove some restrictions from production for testing flexibility
disable_functions =

; Note: Extensions (pcov, xhprof) are loaded via docker-php-ext-enable in Dockerfile
; This file only contains configuration overrides for testing

; Testing-specific ini settings
realpath_cache_size = 8192K
realpath_cache_ttl = 0

; Auto globals for testing
auto_globals_jit = Off
register_argc_argv = On

; Development features for testing
enable_dl = Off
allow_url_fopen = On
allow_url_include = Off

; Serialization settings
serialize_precision = 17
unserialize_callback_func =

; Buffer settings for testing
output_buffering = Off
implicit_flush = On

; HTML settings for test output
html_errors = Off
docref_root =
docref_ext =

; Variable limits for complex test data
variables_order = "EGPCS"
request_order = "GP"

; Log all errors and warnings during testing
log_errors = On
ignore_repeated_errors = Off
ignore_repeated_source = Off
report_memleaks = On

; CLI-specific settings for test runners
cli_server.color = On

; Paths and directories
include_path = ".:/usr/local/lib/php"
extension_dir = "/usr/local/lib/php/extensions/no-debug-non-zts-20230831"

; Resource limits for testing
max_input_time = -1
default_socket_timeout = 60

; Security settings adjusted for testing
allow_url_fopen = On
allow_url_include = Off
auto_prepend_file =
auto_append_file =

; Session testing configuration
session.name = "PHPSESSID_TEST"
session.auto_start = Off
session.cookie_lifetime = 0
session.cookie_path = /
session.cookie_domain =
session.cookie_httponly = On
session.cookie_secure = Off
session.use_strict_mode = On
session.referer_check =
session.gc_probability = 1
session.gc_divisor = 100
session.gc_maxlifetime = 1440

; MySQLi testing settings
mysqli.allow_persistent = Off
mysqli.max_persistent = 0
mysqli.max_links = 20
mysqli.reconnect = Off

; PostgreSQL testing settings
pgsql.allow_persistent = Off
pgsql.auto_reset_persistent = Off
pgsql.max_persistent = 0
pgsql.max_links = 20
